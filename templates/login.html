{% load static %}

<!DOCTYPE html>
<html style="font-size: 16px;" lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Online Voting System, ​Login to your Account">
    <meta name="description" content="">
    <title>Login</title>
    <link rel="stylesheet" href="{% static 'css/nicepage.css' %}" media="screen">
    <link rel="stylesheet" href="{% static 'css/login.css' %}" media="screen">
    <script class="u-script" type="text/javascript" src="{% static 'js/jquery.js' %}" defer=""></script>
    <script class="u-script" type="text/javascript" src="{% static 'js/nicepage.js' %}" defer=""></script>
    <meta name="generator" content="Nicepage 5.19.2, nicepage.com">
    <meta name="referrer" content="origin">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "Organization",
            "name": ""
        }
    </script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="login">
    <meta property="og:type" content="website">
    <meta data-intl-tel-input-cdn-path="intlTelInput/">
</head>
<body data-path-to-root="./" class="u-body u-xl-mode" data-lang="en">
    <section class="u-clearfix u-image u-section-1" id="sec-4ee9" data-image-width="1928" data-image-height="1088">
        <div class="u-clearfix u-sheet u-sheet-1">
            <h2 class="u-text u-text-default u-text-1">Login to your Account</h2>
            <div class="u-form u-form-1">
                <form id="login-form" method="post" class="u-clearfix u-form-spacing-15 u-form-vertical u-inner-form" style="padding: 15px" source="email" name="form">
                    {% csrf_token %}
                    <div class="u-form-group u-form-name u-label-none">
                        <label for="username" class="u-label">Username</label>
                        <input type="text" placeholder="Username" id="username" name="username" class="u-input u-input-rectangle" required="">
                    </div>
                    <div class="u-form-group u-label-none">
                        <label for="password" class="u-label">Password</label>
                        <input type="password" placeholder="Password" id="password" name="password" class="u-input u-input-rectangle" required="required">
                    </div>
                    <div class="u-align-left u-form-group u-form-submit">
                        <button id="capture-button" type="button" class="u-btn u-btn-submit u-button-style">Capture Live Image</button>
                        <input type="hidden" id="image-data" name="image_data">
                    </div>
                    <div class="u-align-left u-form-group u-form-submit">
                        <button type="submit" class="u-btn u-btn-submit u-button-style">Login</button>
                    </div>
                    <div class="u-form-send-message u-form-send-success">Thank you! Your message has been sent.</div>
                    <div class="u-form-send-error u-form-send-message">Unable to send your message. Please fix errors then try again.</div>
                </form>
            </div>
            <h6 class="u-text u-text-default u-text-2">Don’t have an account?</h6>
          
            <h6 class="u-text u-text-default-xl u-text-palette-1-base u-text-3">
                <a class="u-active-none u-border-none u-btn u-button-link u-button-style u-hover-none u-none u-text-palette-1-base u-btn-2" data-href="{% url 'register' %}">&emsp;Create an account</a>
            </h6>
        </div>
    </section>
    <div class="camera-container">
        <video id="camera-stream" autoplay class="camera-stream"></video> <!-- Visible video element for the camera feed -->
    </div>
    <script>
        const captureButton = document.getElementById('capture-button');
        const imageDataField = document.getElementById('image-data');
        const video = document.getElementById('camera-stream');

        captureButton.addEventListener('click', async () => {
            video.style.display = 'block'; // Display the video stream
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                await video.play();

                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const context = canvas.getContext('2d');

                setTimeout(async () => {
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const image_data = canvas.toDataURL('image/jpeg');
                    imageDataField.value = image_data;

                    video.pause();
                    stream.getTracks().forEach(track => track.stop());
                    video.style.display = 'none'; // Hide the video stream
                    alert('Facial Authentication failed.');
                }, 3000);  // Capture an image after 3 seconds (adjust as needed)
            } catch (error) {
                console.error('Error accessing the camera:', error);
            }
        });
    </script>
</body>
</html>
